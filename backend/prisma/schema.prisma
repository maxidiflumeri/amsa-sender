generator client {
  provider = "prisma-client-js"
}

//datasource db {
//  provider = "sqlite"
//  url      = "file:./dev.db"
//}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Campaña {
  id         Int         @id @default(autoincrement())
  nombre     String
  createdAt  DateTime    @default(now())
  enviadoAt  DateTime?
  estado     String      @default("pendiente") // nuevo campo
  pausada    Boolean   @default(false) // <-- NUEVO
  templateId Int?      // FK opcional
  template   Template? @relation(fields: [templateId], references: [id])
  contactos  Contacto[]
  reportes   Reporte[]
  archivada  Boolean @default(false)
  sesiones   String?   // JSON.stringified sessionIds
  config     Json?     // { batchSize, delayEntreMensajes, delayEntreLotes }
}

model Contacto {
  id         Int      @id @default(autoincrement())
  numero     String
  mensaje    String?
  datos      Json?    // ⬅️ Acá irán los datos variables del CSV
  campañaId  Int
  campaña    Campaña  @relation(fields: [campañaId], references: [id])
}


model Reporte {
  id         Int         @id @default(autoincrement())
  numero     String
  mensaje    String
  estado     String
  enviadoAt  DateTime?   // nuevo campo
  campaña   Campaña? @relation(fields: [campañaId], references: [id], onDelete: SetNull)
  campañaId Int?
}

model Sesion {
  id         Int      @id @default(autoincrement())
  sessionId  String   @unique
  estado     String
  ani        String?   // nuevo campo opcional
}

model Template {
  id        Int      @id @default(autoincrement())
  nombre    String
  contenido String   // Ej: "Hola {{nombre}}, tu deuda es de {{deuda}}"
  createdAt DateTime @default(now())
  campañas  Campaña[] // Relación con campañas
}