generator client {
  provider = "prisma-client-js"
}

//datasource db {
//  provider = "sqlite"
//  url      = "file:./dev.db"
//}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Campa침a {
  id         Int         @id @default(autoincrement())
  nombre     String
  createdAt  DateTime    @default(now())
  enviadoAt  DateTime?
  agendadoAt DateTime? // NUEVO: fecha y hora del agendamiento
  estado     String      @default("pendiente") // nuevo campo
  pausada    Boolean   @default(false) // <-- NUEVO
  templateId Int?      // FK opcional
  jobId      String?   // 游녣 NUEVO
  template   Template? @relation(fields: [templateId], references: [id])
  contactos  Contacto[]
  reportes   Reporte[]
  archivada  Boolean @default(false)
  sesiones   String?   // JSON.stringified sessionIds
  config     Json?     // { batchSize, delayEntreMensajes, delayEntreLotes }
}

model Contacto {
  id         Int      @id @default(autoincrement())
  numero     String
  mensaje    String? @db.Text
  datos      Json?    // 拘勇 Ac치 ir치n los datos variables del CSV
  campa침aId  Int
  campa침a    Campa침a  @relation(fields: [campa침aId], references: [id])
}


model Reporte {
  id         Int         @id @default(autoincrement())
  numero     String
  mensaje    String? @db.Text
  estado     String
  aniEnvio   String?  // <--- este campo
  enviadoAt  DateTime?   // nuevo campo
  campa침a   Campa침a? @relation(fields: [campa침aId], references: [id], onDelete: SetNull)
  campa침aId Int?
}

model Sesion {
  id         Int      @id @default(autoincrement())
  sessionId  String   @unique
  estado     String
  ani        String?   // nuevo campo opcional
}

model Template {
  id        Int      @id @default(autoincrement())
  nombre    String
  contenido String @db.Text   // Ej: "Hola {{nombre}}, tu deuda es de {{deuda}}"
  createdAt DateTime @default(now())
  campa침as  Campa침a[] // Relaci칩n con campa침as
}